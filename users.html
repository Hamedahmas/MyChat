<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MyChat - Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <h1 id="title">Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h1>

    <input type="text" id="search" placeholder="Ø¬Ø³ØªØ¬Ùˆ..." oninput="filterUsers()" />

    <div class="users-list">
      <ul id="userList"></ul>
    </div>

    <p class="lang-switch">
      <a href="settings.html">ğŸŒ ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù†</a>
    </p>
  </div>

  <script>
    // ØªÙ†Ø¸ÛŒÙ… Ø²Ø¨Ø§Ù† Ùˆ Ø¬Ù‡Øª ØµÙØ­Ù‡
    const lang = localStorage.getItem('mychat_language') || 'fa';
    document.documentElement.lang = lang;
    document.documentElement.dir = (lang === 'fa' || lang === 'ar') ? 'rtl' : 'ltr';

    // ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§
    const texts = {
      fa: {
        title: 'Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†',
        search: 'Ø¬Ø³ØªØ¬Ùˆ...',
        startChat: 'Ø´Ø±ÙˆØ¹ Ú¯ÙØªÚ¯Ùˆ Ø¨Ø§ '
      },
      en: {
        title: 'Search Users',
        search: 'Search...',
        startChat: 'Start chat with '
      },
      ar: {
        title: 'Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',
        search: 'Ø§Ø¨Ø­Ø«...',
        startChat: 'Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ '
      },
      ja: {
        title: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢',
        search: 'æ¤œç´¢...',
        startChat: 'ãƒãƒ£ãƒƒãƒˆé–‹å§‹: '
      }
    };

    const t = texts[lang];
    document.getElementById('title').textContent = t.title;
    document.getElementById('search').placeholder = t.search;

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
    const allUsers = JSON.parse(localStorage.getItem('users')) || [];
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    const otherUsers = allUsers.filter(u => u.username !== currentUser.username);

    const listEl = document.getElementById('userList');
    let visibleUsers = [...otherUsers];

    function renderUsers() {
      listEl.innerHTML = '';
      if (visibleUsers.length === 0) {
        const li = document.createElement('li');
        li.textContent = 'Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯';
        if (lang === 'en') li.textContent = 'No users found';
        else if (lang === 'ar') li.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†';
        else if (lang === 'ja') li.textContent = 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
        listEl.appendChild(li);
        return;
      }

      visibleUsers.forEach(user => {
        const li = document.createElement('li');
        li.textContent = user.username;
        li.onclick = () => startChat(user.username);
        listEl.appendChild(li);
      });
    }

    function filterUsers() {
      const query = document.getElementById('search').value.trim().toLowerCase();
      visibleUsers = otherUsers.filter(u => u.username.toLowerCase().includes(query));
      renderUsers();
    }

    function startChat(recipient) {
      localStorage.setItem('chatWith', recipient);
      window.location.href = 'chat.html';
    }

    // Ø§Ø¬Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
    renderUsers();
  </script>
</body>
</html>
