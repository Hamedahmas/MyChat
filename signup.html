<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MyChat - Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <h1 id="title">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± MyChat</h1>
    <form onsubmit="register(event)">
      <input type="text" id="username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ" required />
      <input type="password" id="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" required />
      <input type="password" id="confirmPassword" placeholder="ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" required />
      <button type="submit" id="signupBtn">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
    </form>
    <p class="lang-switch">
      <a href="settings.html">ğŸŒ ØªØºÛŒÛŒØ± Ø²Ø¨Ø§Ù†</a>
    </p>
    <p id="error" class="message error" style="display:none;"></p>
  </div>

  <script>
    // ØªÙ†Ø¸ÛŒÙ… Ø²Ø¨Ø§Ù† Ùˆ Ø¬Ù‡Øª ØµÙØ­Ù‡
    const lang = localStorage.getItem('mychat_language') || 'fa';
    document.documentElement.lang = lang;
    document.documentElement.dir = (lang === 'fa' || lang === 'ar') ? 'rtl' : 'ltr';

    // ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§
    const texts = {
      fa: {
        title: 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± MyChat',
        username: 'Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ',
        password: 'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±',
        confirm: 'ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±',
        signup: 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…',
        error_match: 'Ø±Ù…Ø²Ù‡Ø§ Ø¨Ø§ Ù‡Ù… Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ù†Ø¯',
        error_exists: 'Ø§ÛŒÙ† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª'
      },
      en: {
        title: 'Sign Up for MyChat',
        username: 'Username',
        password: 'Password',
        confirm: 'Confirm Password',
        signup: 'Sign Up',
        error_match: 'Passwords do not match',
        error_exists: 'This username already exists'
      },
      ar: {
        title: 'Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ MyChat',
        username: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',
        password: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
        confirm: 'ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
        signup: 'ØªØ³Ø¬ÙŠÙ„',
        error_match: 'ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†',
        error_exists: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹'
      },
      ja: {
        title: 'MyChat ã«ç™»éŒ²',
        username: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼å',
        password: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰',
        confirm: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª',
        signup: 'ç™»éŒ²',
        error_match: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“',
        error_exists: 'ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯ã™ã§ã«å­˜åœ¨ã—ã¾ã™'
      }
    };

    const t = texts[lang];
    document.getElementById('title').textContent = t.title;
    document.getElementById('username').placeholder = t.username;
    document.getElementById('password').placeholder = t.password;
    document.getElementById('confirmPassword').placeholder = t.confirm;
    document.getElementById('signupBtn').textContent = t.signup;

    function register(e) {
      e.preventDefault();

      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const confirmPassword = document.getElementById('confirmPassword').value.trim();
      const errorEl = document.getElementById('error');

      if (password !== confirmPassword) {
        errorEl.textContent = t.error_match;
        errorEl.style.display = 'block';
        return;
      }

      let users = JSON.parse(localStorage.getItem('users')) || [];

      if (users.find(u => u.username === username)) {
        errorEl.textContent = t.error_exists;
        errorEl.style.display = 'block';
        return;
      }

      const newUser = { username, password };
      users.push(newUser);
      localStorage.setItem('users', JSON.stringify(users));
      localStorage.setItem('currentUser', JSON.stringify(newUser));
      window.location.href = 'chat.html';
    }
  </script>
</body>
</html>
